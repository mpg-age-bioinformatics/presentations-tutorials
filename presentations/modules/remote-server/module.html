<section id="help-your-self-on-a-remote-server">
  <h1>Help yourself on a remote server</h1>
  <p><highlight>Welcome to the "Help yourself on a remote server" tutorial.<highlight></p>
  <p>At the end of the this tutorial you will be able to move around in a shell, run software, write and run scripts on a remote server.
    <br>For questions or suggestions  feel free to <a href="mailto:jorge.boucas@age.mpg.de">contact</a> us.</p>
  <aside class="notes" data-markdown>
  This tutorial is preceeded by The Unix Shell.
  </aside>
</section>

<section id="outline2">
  <h1>Outline</h1>
  <font size="6" align="left">
      <ul style="padding-left: 100px;">
        <li>What is the shell?
        <br><li>Connecting to a remote server
        <br><li>Copying files to/from a remote server
        <br><li>The modules system
        <br><li>Shifter/Docker for HPC
        <br><li>Installing software without `su` access
        <br><li>Installing R packages
        <br><li>Installing python packages
        <br><li>Shortcut: Tab Completion
        <br><li>Installing perl packages
        <br><li>SLURM
      </ul>
  </font>
</section>

<section id="connecting">
  <h1>Connecting to a remote server</h1>
  <font size=6>
    <ul>
      Connecting to a remote server over a Secure Shell (ssh)
      – ssh username@remote.adress :
      <pre><code data-trim>
        ssh JBoucas@amalia.age.mpg.de
      </code></pre>
      With X forwarding:
      <pre><code data-trim>
        ssh –X JBoucas@amalia.age.mpg.de
      </code></pre>
    </ul>
  </font>
</section>

<section id="rcfiles">
  <h1>Download rc files for your user into your home folder in amalia</h1>
    <ul>
      <font size=6>
      <pre><code data-trim>
        cd

        wget https://raw.githubusercontent.com/\
        mpg-age-bioinformatics/cluster_first_steps/master/.bashrc

        wget https://raw.githubusercontent.com/\
        mpg-age-bioinformatics/cluster_first_steps/master/.bash_profile

        source ~/.bash_profile
        source ~/.bashrc
      </code></pre>
      Remember that next time you login this files will be automatically sourced.
    </ul>
  </font>
</section>

<section id="scp">
  <h1>Copying files to/from a remote server</h1>
    <ul>
      <font size=6>
        Copying files over ssh <u>to</u> your home folder on a remote server:
        <pre><code data-trim>
          scp file.txt UName@ServerAddress:~/
        </code></pre>
        Copying files over ssh <u>from</u> your home folder on a remote server:
        <pre><code data-trim>
          scp UName@ServerAddress:~/file.txt .
        </code></pre>
        Both `scp` will only allow you to copy files (not directories)
        unless you use the `-r` argument for `recursively`.
        For speed use `-o Cipher=arcfour`.
        <br>rsync to a remote server
        <pre><code data-trim>
          rsync –rtvh –e "ssh –c arcfour" source_folder \
          UName@ServerAddress:destination
        </code></pre>
        Not all servers will have the less costly cipher arcfour
        encryption algorithm and therefore you can remove the whole
        `-e "ssh –c arcfour"` block.
    </ul>
  </font>
</section>

<section id="modules">
  <h1>The modules system</h1>
    <ul>
      <font size=6>
        A centralized software system.
        The modules system <b>loads software</b> (version of choice)
        and changes <b>environment</b> variables (eg. LD_LIBRARY_PATH)
    </ul>
        <div class="column">
          <pre><code data-trim>
            module avail
            module whatis samtools
            module show samtools
            module load samtools
            module list
            module unload samtools
            module purge
          </code></pre>
        </div>

        <div class="column">
            <pre><code data-trim>
            # shows available modules
            # shows a description of the samtools module
            # shows environment changes for samtools
            # loads samtools
            # lists all loaded modules
            # unloads the samtools module
            # unloads all loaded modules
          </code></pre>
        </div>
    <ul>
        more on <a href="http://modules.sourceforge.net">http://modules.sourceforge.net</a>
    </ul>
  </font>
</section>

<section id="docker">
  <h1>Shifter/Docker for HPC</h1>
  <br><i>Mobile, ready to go, reproducible science!</i>
</section>

<section id="computers">
  <h1>Computers are not all the same</h1>
  <div style="position: absolute; left: 0.2em">
  <img src="modules/remote-server/docker1.png" class="fragment fade-out" data-fragment-index="1"/>
  </div>
  <div style="position: absolute; left: 0.2em" class="fragment fade-in" data-fragment-index="1">
  <img src="modules/remote-server/docker2.png" class="fragment fade-out" data-fragment-index="2"/>
  </div>
  <div style="position: absolute; left: 0.2em" class="fragment fade-in" data-fragment-index="2">
  <img src="modules/remote-server/docker3.png"/>
  </div>
</section>

<section id="containers">
  <h1>Containers</h1>
  <div style="position: absolute; left: 3.5em">
  <img src="modules/remote-server/docker6.png" width="900" class="fragment fade-out" data-fragment-index="1"/>
  </div>
  <div style="position: absolute; left: 3.5em" class="fragment fade-in" data-fragment-index="1">
  <img src="modules/remote-server/docker5.png" width="900" class="fragment fade-out" data-fragment-index="2"/>
  </div>
  <div style="position: absolute; left: 3.5em" class="fragment fade-in" data-fragment-index="2">
  <img src="modules/remote-server/docker4.png" width="900"/>
  </div>
</section>

<section id="shifter">
  <h1>Shifter/Docker for HPC</h1>
    <ul>
      <font size=6>
        load respective module
        <pre><code data-trim>
          module load shifter
        </code></pre>
        list available images
        <pre><code data-trim>
          shifterls
        </code></pre>
        get an interactive shell on ubuntu and check
        that you are in the intended image
        <pre><code data-trim>
          shifter --image=ubuntu:15.10 bash -login
          cat /etc/lsb-release
        </code></pre>
        use the Bioinformatics image
        <pre><code data-trim>
          shifter --image=mpgagebioinformatics/bioinformatics_software:v1.0.0
        </code></pre>
        run a script inside an image
        <pre><code data-trim>
          shifter --image=&ltprovider&gt/&ltimage_name&gt:&lttag&gt /path/to/script
        </code></pre>
    </ul>
  </font>
</section>

<section id="shifteri">
  <h1>Working interactively on the mpi age bioinformatics software image</h1>
    <ul>
      <font size=6>
        load respective module
        <pre><code data-trim>
          module load shifter
        </code></pre>
        list available images
        <pre><code data-trim>
          shifterls
        </code></pre>
        check if you have R
        <pre><code data-trim>
          which R
        </code></pre>
        login to our software image
        <pre><code data-trim>
          shifter --image=mpgagebioinformatics/bioinformatics_software:v1.1.0
          pwd
          module avail
          module load rlang
          which R
        </code></pre>
        You will now see `R`'s path in the image.
    </ul>
  </font>
</section>

<section id="shifters">
  <h1>Running a script inside the mpi age bioinformatics software image</h1>
    <ul>
      <font size=6>
        Example `~/test.shifter.sh`:
        <pre><code data-trim>
          #!/bin/bash
          source ~/.bashrc

          module load rlang python

          which python

          python << EOF
          print "This is python"
          EOF

          which R

          Rscript -e "print('This is R')"
        </code></pre>
        Running the script:
        <pre><code data-trim>
          chmod +x test.shifter.sh
          shifter \
            --image=mpgagebioinformatics/bioinformatics_software:v1.0.1 \
            ./test.sh
        </code></pre>
      </font>
    </ul>
</section>

<section id="shifterinfos">
  <h1>Running a script inside the mpi age bioinformatics software image</h1>
    <ul>
      <font size=6>
        More infos on
        	<br>&nbsp&nbsp&nbsp&nbsp shifter,
        	<br>&nbsp&nbsp&nbsp&nbsp docker (eg. for your own laptop),
        	<br>&nbsp&nbsp&nbsp&nbsp singularity (running @ draco.mpcdf.mpg.de),
        	<br>&nbsp&nbsp&nbsp&nbsp and creation of images on

        	<br>&nbsp&nbsp&nbsp&nbsp <a href="http://bioinformatics.age.mpg.de/#callout">http://bioinformatics.age.mpg.de/#callout</a>  > Jupyter on Docker
        	<br>&nbsp&nbsp&nbsp&nbsp <a href="https://github.com/mpg-age-bioinformatics/cluster_first_steps#shifter">https://github.com/mpg-age-bioinformatics/cluster_first_steps#shifter</a>

        <br><br>More infos on our software image and how to run it on your laptop:
        	<br>&nbsp&nbsp&nbsp&nbsp <a href="https://github.com/mpg-age-bioinformatics/software_docker#software-container">https://github.com/mpg-age-bioinformatics/software_docker#software-container</a>
      </font>
      </ul>
</section>

<section id="avail">
  <h1>module avail</h1>
    <ul>
      <font size=5>
        Example `module avail` output.
        <pre><code data-trim>
          ------------------------- /modules/modulefiles/bioinformatics -------------------------
          bedtools/2.26.0(default)  hisat/2.0.4(default)      spades/3.10.0(default)
          bowtie/2.2.9(default)     igvtools/2.3.89(default)  sratoolkit/2.8.1(default)
          bwa/0.7.15(default)       lofreq/2.1.2(default)     star/2.5.2b(default)
          bwtool/face601(default)   methpipe/3.4.3(default)   stringtie/1.3.0(default)
          cufflinks/2.2.1(default)  picard/2.8.1(default)     tophat/2.1.1(default)
          fastqc/0.11.5(default)    samtools/1.3.1(default)   vcftools/0.1.14(default)
          gatk/3.4.46               skewer/0.2.2(default)     walt/1.0.0(default)
          gatk/4.beta.5(default)    snpeff/4.3.i(default)
          ---------------------------- /modules/modulefiles/general -----------------------------
          java/8.0.111(default)       perl/5.24.1(default)        rlang/3.3.2(default)
          jdk/8.0.151(default)        python/2.7.12(default)      ruby/2.4.2(default)
          jupyterhub/0.7.2(default)   python/3.6.0                ruby-install/0.6.1(default)
          ------------------------------ /modules/modulefiles/libs ------------------------------
          bzip2/1.0.6(default)     openblas/0.2.19(default)
          gsl/2.4.0(default)       xz/5.2.2(default)
        </code></pre>
        Note the 3 distinct blocks of software being shown (bionformatics, general, libs).
        The distinct blocks are generated by the different paths kept on the `MODULEPATH` variable set like this:
        <pre><code data-trim>
          export MODULEPATH=/modules/modulefiles/bioinformatics:/modules/modulefiles/general:/modules/modulefiles/libs
        </code></pre>
    </font>
  </ul>
</section>

<section id="msystem">
  <h1>The modules system</h1>
    <ul>
      <font size=5>
        `module avail` simply lists the contents of the `MODULEPATH` variable.
        <pre><code data-trim>
          container:/modules/modulefiles/general$ tree -L 2
          ├── java
          │   └── 8.0.111
          ├── jdk
          │   └── 8.0.151
          ├── jupyterhub
          │   └── 0.7.2
          ├── perl
          │   └── 5.24.1
          ├── python
          │   ├── 2.7.13
          │   └── 3.6.0
          ├── rlang
          │   └── 3.3.2
          ├── ruby
          │   └── 2.4.2
          └── ruby-install
              └── 0.6.1
          8 directories, 9 files
          </code></pre>
          example content of a software folder in the modules folder
          <pre><code data-trim>
            container:/modules/modulefiles/general$ ls -al python/
            total 20
            drwxr-xr-x 1 root root 4096 Sep 16 11:45 .
            drwxr-xr-x 1 root root 4096 Nov 12 15:29 ..
            -rw-r--r-- 1 root root 1781 Sep 16 11:42 2.7.12
            -rw-r--r-- 1 root root 1766 Sep 16 11:45 3.6.0
            -rw-r--r-- 1 root root  137 Sep 16 11:42 .version
          </code></pre>
    </font>
  </ul>
</section>

<section id="msystem2">
  <h1>The modules system</h1>
    <ul>
      <font size=6>
        <pre><code data-trim>
          container:/modules/modulefiles/general$ ls -al python/
          total 20
          drwxr-xr-x 1 root root 4096 Sep 16 11:45 .
          drwxr-xr-x 1 root root 4096 Nov 12 15:29 ..
          -rw-r--r-- 1 root root 1781 Sep 16 11:42 2.7.12
          -rw-r--r-- 1 root root 1766 Sep 16 11:45 3.6.0
          -rw-r--r-- 1 root root  137 Sep 16 11:42 .version
        </code></pre>
        `2.7.12` module file for python 2.7.12
        <br>`3.6.0` module file for python 3.6.0
        <br>`.version` file defining the default version:
        <pre><code data-trim>
          #%Module1.0###########################################################
          ##
          ## version file for python
          ##
          set ModulesVersion      "2.7.12"
        </code></pre>
  </font>
</ul>
</section>

<section id="module_file">
  <h1>module file</h1>
    <ul>
      <font size=5>
        <pre><code data-trim>
#%Module3.2.10#####################################################################
proc ModulesHelp { } {
      global version
      puts stderr "\n\tVersion 2.7.13 of python\n"
}

module-whatis   "Version 2.7.13 of python"

# for Tcl script use only
set     version      "3.2.10"

conflict python
prepend-path PATH /modules/software/python/2.7.13/bin
prepend-path LD_LIBRARY_PATH /modules/software/python/2.7.13/lib
prepend-path CPATH /modules/software/python/2.7.13/include
prepend-path C_INCLUDE_PATH /modules/software/python/2.7.13/include
prepend-path CPLUS_INCLUDE_PATH /modules/software/python/2.7.13/include
prepend-path OBJC_INCLUDE_PATH /modules/software/python/2.7.13/include
prepend-path MANPATH /modules/software/python/2.7.13/share/man
prepend-path INFODIR /modules/software/python/2.7.13/share/man
set home $::env(HOME)
set pythonuser $home/.software_container/.python/2.7.13/bin
exec /bin/mkdir -p $pythonuser
prepend-path PATH $home/.software_container/.python/2.7.13/bin
set jupyter_runtime_dir $home/.software_container/.python/2.7.13/jupyter/run
exec /bin/mkdir -p $jupyter_runtime_dir
setenv JUPYTER_RUNTIME_DIR $home/.software_container/.python/2.7.13/jupyter/run
set jupyter_data_dir $home/.software_container/.python/2.7.13/jupyter/data
exec /bin/mkdir -p $jupyter_data_dir
setenv JUPYTER_DATA_DIR $home/.software_container/.python/2.7.13/jupyter/data
setenv PYTHONHOME /modules/software/python/2.7.13/
setenv PYTHONPATH /modules/software/python/2.7.13/lib/python2.7
setenv PYTHONUSERBASE $home/.software_container/.python/2.7.13/
exec /bin/mkdir -p $home/.software_container/.python/2.7.13/pythonpath/site-packages
module load openblas/0.2.19
setenv CLFAGS -I/modules/software/openblas/0.2.19/include
setenv LDFLAGS -L/modules/software/openblas/0.2.19/lib
        </code></pre>
  </font>
</ul>
</section>

<section id="module_file_1">
  <h1>module file</h1>
    <ul>
      <font size=6>
        <pre><code data-trim>
#%Module3.2.10#####################################################################
proc ModulesHelp { } {
      global version
      puts stderr "\n\tVersion 2.7.13 of python\n"
}
        </code></pre>
        Help message shown for this modules with`module help python/2.7.13`
        <pre><code data-trim>
          module-whatis   "Version 2.7.13 of python"
        </code></pre>
        Message to be shown by `module whatis python/2.7.13`.
        <pre><code data-trim>
        # for Tcl script use only
        set     version      "3.2.10"
        </code></pre>
        Modules system version.
        <pre><code data-trim>
          conflict python
        </code></pre>
        Conflicts. ie. Do not load if a different python version is already loaded.
  </font>
</ul>
</section>

<section id="module_file_2">
  <h1>module file</h1>
    <ul>
      <font size=6>
        <pre><code data-trim>
          prepend-path PATH /modules/software/python/2.7.13/bin
          prepend-path LD_LIBRARY_PATH /modules/software/python/2.7.13/lib
          prepend-path CPATH /modules/software/python/2.7.13/include
          prepend-path C_INCLUDE_PATH /modules/software/python/2.7.13/include
          prepend-path CPLUS_INCLUDE_PATH /modules/software/python/2.7.13/include
          prepend-path OBJC_INCLUDE_PATH /modules/software/python/2.7.13/include
          prepend-path MANPATH /modules/software/python/2.7.13/share/man
          prepend-path INFODIR /modules/software/python/2.7.13/share/man
        </code></pre>
        Paths prepended when the module is loaded and removed when the module is unloaded.
        <pre><code data-trim>
          set home $::env(HOME)
        </code></pre>
        `$::env(HOME)` captures the variable HOME from the environment of the user loading the module.
        <br>`set home $::env(HOME)` sets a variable `home` to be used within the module with the result of `$::env(HOME)`.
        <pre><code data-trim>
          set pythonuser $home/.software_container/.python/2.7.13/bin
        </code></pre>
        Sets the python user variable to be used within the module.
      </font>
    </ul>
</section>

<section id="module_file_3">
  <h1>module file</h1>
    <ul>
      <font size=6>
        <pre><code data-trim>
          exec /bin/mkdir -p $pythonuser
        </code></pre>
        Executes the command `/bin/mkdir –p $pythonuser` every time the module is loaded.
        <pre><code data-trim>
          prepend-path PATH $home/.software_container/.python/2.7.13/bin
        </code></pre>
        Prepends `$home/.software_container/.python/2.7.13/bin` to the user environment PATH variable.
        <pre><code data-trim>
          setenv PYTHONUSERBASE $home/.software_container/.python/2.7.13/
          exec /bin/mkdir -p $home/.software_container/.python/2.7.13/pythonpath/site-packages
        </code></pre>
        Please note `PYTHONUSERBASE`
        <pre><code data-trim>
          module load openblas/0.2.19
        </code></pre>
        Loads other modules as dependencies when loading the python module.
      </font>
    </ul>
</section>

<section id="install">
  <h1>Installing software without `su` access</h1>
    <ul>
      <font size=6>
        Several examples can be obtained from:
        <br><a href="https://github.com/mpg-age-bioinformatics/draco_pipelines/blob/master/software/software.sh">https://github.com/mpg-age-bioinformatics/draco_pipelines/blob/master/software/software.sh</a>
        <br><br>Structure:
      </ul>
        <div>
            <img src="modules/remote-server/soft_structure.png" width="600" align="center">
        </div>
      <ul>
        <pre><code data-trim>
          mkdir –p ~/my_software/sources ~/my_software/software ~/my_software/logs ~/my_software/modules
        </code></pre>
      </font>
    </ul>
</section>

<section id="install2">
  <h1>Installing software without `su` access</h1>
    <ul>
      <font size=7>
        Download and edit the script for automatic generation of module files:
        <pre><code data-trim>
           cd ~/
           wget https://raw.githubusercontent.com/mpg-age-bioinformatics/\
           draco_pipelines/master/software/newmod.sh
           sed -i 's/\/u\/jboucas\/modules/~\/my_software/g' newmod.sh
           chmod +x newmod.sh
        </code></pre>
        Add the `~/my_software/modules` to the MODULEPATH:
        <pre><code data-trim>
        export MODULEPATH=$MODULEPATH:~/my_software/modules
        </code></pre>
        You might want to add this line to your `~/.bashrc`
      </font>
    </ul>
</section>

<section id="install3">
  <h1>Installing software without `su` access</h1>
    <ul>
      <font size=7>
        <pre><code data-trim>
           cd ~/my_software/sources
           wget http://zlib.net/pigz/pigz-2.3.4.tar.gz
           tar -zxvf pigz-2.3.4.tar.gz
           cd pigz-2.3.4
           make
           mkdir –p ~/my_software/software/pigz/2.3.4/bin
           cp pigz unpigz ~/my_software/software/pigz/2.3.4/bin
           ~/newmod.sh –s pigz –p ~/my_software/modules –v 2.3.4 –d 2.3.4
        </code></pre>
        Test it
        <pre><code data-trim>
         module avail
         module show pigz/2.3.4
         module load pigz/2.3.4
         which pigz
        </code></pre>
      </font>
    </ul>
</section>

<section id="install4">
  <h1>Installing software without `su` access</h1>
    <ul>
      <font size=7>
        <pre><code data-trim>
           cd ~/my_software/sources
           wget http://zlib.net/zlib-1.2.11.tar.gz
           tar -zxvf zlib-1.2.11.tar.gz
           cd zlib-1.2.11
           make
           mkdir –p ~/my_software/software/libz/1.2.11
           ./configure –prefix=~/my_software/software/libz/1.2.11
           make
           make install
           ~/newmod.sh –s libz –p ~/my_software/modules –v 1.2.11 –d 1.2.11
        </code></pre>
      </font>
    </ul>
</section>

<section id="install5">
  <h1>Installing software without `su` access</h1>
    <ul>
      <font size=7>
        <pre><code data-trim data-noescape>
           echo "<mark>#!/bin/bash
           cd ~/my_software/sources
           wget http://zlib.net/zlib-1.2.11.tar.gz
           tar -zxvf zlib-1.2.11.tar.gz
           cd zlib-1.2.11
           make
           mkdir –p ~/my_software/software/libz/1.2.11
           ./configure –prefix=~/my_software/software/libz/1.2.11
           make
           make install
           ~/newmod.sh –s libz –p ~/my_software/modules –v 1.2.11 –d 1.2.11</mark>
           " > ~/my_software/logs/libz-1.2.11.sh
           chmod +x ~/my_software/logs/libz-1.2.11.sh
           ~/my_software/logs/libz-1.2.11.sh 2>&1 | tee \
           ~/my_software/logs/libz-1.2.11.log
        </code></pre>
      </font>
    </ul>
</section>

<section id="install6">
  <h1>Installing software without `su` access</h1>
    <ul>
      <font size=6>
        <pre><code data-trim data-noescape>
if [ ! -f $MODF/libs/libz/1.2.8 ]; then
  echo 'zlib-1.2.8'
  echo '<mark>#!/bin/bash</mark>
  <mark>module list</mark>
  <mark>cd $SOUR</mark>
  <mark>wget -O l.tar.gz http://zlib.net/zlib-1.2.8.tar.gz</mark>
  <mark>mv l.tar.gz zlib-1.2.8.tar.gz</mark>
  <mark>tar -zxvf zlib-1.2.8.tar.gz</mark>
  <mark>cd zlib-1.2.8</mark>
  <mark>mkdir $SOFT/libz/1.2.8</mark>
  <mark>./configure --prefix=$SOFT/libz/1.2.8</mark>
  <mark>make</mark>
  <mark>make install</mark>
  <mark>newmod.sh \</mark>
  <mark>-s libz \</mark>
  <mark>-p $MODF/libs/ \</mark>
  <mark>-v 1.2.8 \</mark>
  <mark>-d 1.2.8</mark>
  ' > $LOGS/libz-1.2.8.sh
  chmod 755 $LOGS/libz-1.2.8.sh
  srun -o $LOGS/libz-1.2.8.out $LOGS/libz-1.2.8.sh
fi
        </code></pre>
      </font>
    </ul>
</section>

<section id="r">
  <h1>Installing R packages</h1>
    <ul>
      <font size=6>
        R standard packages:
        <pre><code data-trim data-noescape>
          base  datasets  graphics  grDevices  methods  parallel
          stats  stats4   tcltk  tools  utils
        </code></pre>
        This are the only packages that should be inside `lib64/R/library`.
        The `library` folder should have permissions `chmod -R 555 library`.
        This will enforce the use of the `R_LIBS_USER` variable for installation of new packages.
        <br>Alternative (eg. install biomaRt):
        <pre><code data-trim data-noescape>
          source("https://bioconductor.org/biocLite.R")
          biocLite("biomaRt", lib=Sys.getenv("R_LIBS_USER"))
        </code></pre>
        The `lib` argument can also be used in (eg. install packrat):
        <pre><code data-trim data-noescape>
          install.packages("packrat", lib=Sys.getenv("R_LIBS_USER"))
        </code></pre>
      </font>
    </ul>
</section>

<section id="python">
  <h1>Installing python packages</h1>
    <ul>
      <font size=6>
        Installing the AGEpy package:
        <pre><code data-trim data-noescape>
          module load python
          pip install AGEpy --user
        </code></pre>
        Alternative 1:
        <pre><code data-trim data-noescape>
          module load python
          git clone https://github.com/mpg-age-bioinformatics/AGEpy
          cd AGEpy
          pip install ../AGEpy --user
        </code></pre>
        Alternative 1b (no package control):
        <pre><code data-trim data-noescape>
          cd AGEpy
          python setup.py install --user
        </code></pre>
        The `--user` argument will make use of the `PYTHONUSERBASE` variable.
      </font>
    </ul>
</section>

<section id="perl">
  <h1>Installing perl packages</h1>
    <ul>
      <font size=7>
        Perl libraries are loaded from the value of `PERL5LIB`. We have added a variable to module perl to ease local installations - `PERLUSER` - check out the content of these two variables.
        <br>Example instalation of Log::Log4perl:
        <pre><code data-trim data-noescape>
          module load perl/5.24.1
          cpanm Log::Log4perl -l $PERLUSER
        </code></pre>
        check where it got installed
        <pre><code data-trim data-noescape>
          perldoc -l Log::Log4perl
        </code></pre>
      </font>
    </ul>
</section>

<section id="amalia">
  <h1>SLURM (Simple Linux Utility for Resource Management )</h1>
  <div>
      <img src="modules/remote-server/amalia.png" width="900" align="center">
  </div>
</section>

<section id="slurm1">
  <h1>SLURM: Why an HPC cluster?</h1>
  <div>
      <img src="modules/remote-server/cluster1.png" width="900" align="center">
  </div>
</section>

<section id="slurm2">
  <h1>SLURM: Why an HPC cluster?</h1>
  <div>
      <img src="modules/remote-server/cluster2.png" width="900" align="center">
  </div>
</section>

<section id="slurm3">
  <h1>SLURM: Why SLURM?</h1>
  <div>
      <img src="modules/remote-server/cluster3.png" width="900" align="center">
  </div>
</section>

<section id="slurm4">
  <h1>SLURM: How to?</h1>
  <div>
      <img src="modules/remote-server/cluster4.png" width="900" align="center">
  </div>
</section>

<section id="slurm5">
  <h1>SLURM: How to?</h1>
  <div>
      <img src="modules/remote-server/cluster5.png" width="900" align="center">
  </div>
</section>

<section id="slurm6">
  <h1>SLURM: How to?</h1>
  <div>
      <img src="modules/remote-server/cluster6.png" width="900" align="center">
  </div>
</section>

<section id="slurm7">
  <h1>SLURM: How to?</h1>
  <div>
      <img src="modules/remote-server/cluster7.png" width="900" align="center">
  </div>
</section>

<section id="slurm8">
  <h1>SLURM: How to?</h1>
  <div>
      <img src="modules/remote-server/cluster8.png" width="900" align="center">
  </div>
</section>

<section id="slurm9">
  <h1>SLURM: How to?</h1>
  <div>
      <img src="modules/remote-server/cluster9.png" width="900" align="center">
  </div>
</section>

<section id="slurm10">
  <h1>SLURM: How to?</h1>
  <div>
      <img src="modules/remote-server/cluster10.png" width="900" align="center">
  </div>
</section>


<section id="slurm11">
  <h1>SLURM: How to?</h1>
  <div>
      <img src="modules/remote-server/cluster11.png" width="900" align="center">
  </div>
</section>

<section id="slurm12">
  <h1>SLURM: scripting</h1>
  <div>
      <img src="modules/remote-server/cluster12.png" width="900" align="center">
  </div>
</section>

<section id="slurm13">
  <h1>SLURM with the modules system</h1>
  <div>
      <img src="modules/remote-server/cluster13.png" width="900" align="center">
  </div>
</section>

<section id="slurm14">
  <h1>SLURM with shifter<br>and the modules system</h1>
  <div>
      <img src="modules/remote-server/cluster14.png" width="900" align="center">
  </div>
</section>

<section id="slurm15">
  <h1>SLURM: iterating jobs over files</h1>
  <div>
      <img src="modules/remote-server/cluster15.png" width="900" align="center">
  </div>
</section>

<section id="slurm16">
  <h1>SLURM: iterating jobs over files</h1>
  <div>
      <img src="modules/remote-server/cluster16.png" width="900" align="center">
  </div>
</section>

<section id="slurm17">
  <h1>SLURM: iterating jobs over files</h1>
  <div>
      <img src="modules/remote-server/cluster17.png" width="900" align="center">
  </div>
</section>

<section id="slurm18">
  <h1>SLURM with shifter</h1>
  <div>
      <img src="modules/remote-server/cluster18.png" width="900" align="center">
  </div>
</section>

<section id="slurm19">
  <h1>SLURM: other options</h1>
    <ul>
      <font size=7>
        <pre><code data-trim data-noescape>
          --mail-type=BEGIN,END,FAIL,REQUEUE,ALL
        </code></pre>
        Specifies when email is sent to the job owner. The option argument may consist of a combination of the allowed mail types
        <pre><code data-trim data-noescape>
        --mail-user=&ltusername&gt@age.mpg.de
        </code></pre>
      </font>
    </ul>
</section>

<section id="slurm20">
  <h1>SLURM: sview</h1>
  <div>
      <img src="modules/remote-server/sview.png" width="900" align="center">
  </div>
</section>

<section id="slurm21">
  <h1>SLURM: other useful commands</h1>
    <ul>
      <font size=6>
        show the partitions
        <pre><code data-trim data-noescape>
          sinfo
        </code></pre>
        show information on nodes
        <pre><code data-trim data-noescape>
        sinfo -N -O partitionname,nodehost,cpus,cpusload,freemem,memory
        </code></pre>
        requires X forwarding and allows viewing and manipulation of submitted jobs
        <pre><code data-trim data-noescape>
        sview
        </code></pre>
        lists running jobs
        <pre><code data-trim data-noescape>
        squeue
        </code></pre>
        show the queue for a user
        <pre><code data-trim data-noescape>
        squeue -u &ltusername&gt
        </code></pre>
      </font>
    </ul>
</section>

<section id="slurm22">
  <h1>SLURM: other useful commands</h1>
    <ul>
      <font size=6>
        cancels job 65673
        <pre><code data-trim data-noescape>
        scancel 65673
        </code></pre>

        cancels all jobs of user JBoucas
        <pre><code data-trim data-noescape>
        scancel -u JBoucas
        </code></pre>

        shows detailed resource information on job 43433
        <pre><code data-trim data-noescape>
        scontrol show job 43433
        </code></pre>

        show information on a partition
        <pre><code data-trim data-noescape>
        scontrol show partition &ltparition name&gt
        </code></pre>

        show information on a node
        <pre><code data-trim data-noescape>
        scontrol show node &ltnode name&gt
        </code></pre>

      </font>
    </ul>
</section>

<section id="slurm23">
  <h1>SLURM: other useful commands</h1>
    <ul>
      <font size=6>

        starts an interactive terminal window on node15
        <pre><code data-trim data-noescape>
        srun -w node15 --pty bash
        </code></pre>

        submit a job3 after job1 and job2 are successfully ready
        <pre><code data-trim data-noescape>
        job1=$(sbatch --parsable &ltscript1&gt)
        job2=$(sbatch --parsable &ltscript2&gt)
        sbatch -d afterok:${job1}:${job2} &ltscript3&gt
        </code></pre>

        attach to a running job and run a command
        <pre><code data-trim data-noescape>
        srun --jodib &ltJOBID&gt --pty &ltcommand&gt
        </code></pre>

        change the partitions of a pending job
        <pre><code data-trim data-noescape>
        scontrol update job &ltjob id&gt partition=&ltpartition1&gt,&ltpartition2&gt,&ltpartition3&gt
        </code></pre>

      </font>
    </ul>
</section>

<section id="notesser">
  <h1>Notes</h1>
    <ul>
      <font size=7>
        For current information on RStudio server and JupyterHub please check our cluster first steps page:
        <br><a href="https://github.com/mpg-age-bioinformatics/cluster_first_steps">https://github.com/mpg-age-bioinformatics/cluster_first_steps</a>
        <br><br>SLURM manual:
        <br><a href="http://slurm.schedmd.com/man_index.html">http://slurm.schedmd.com/man_index.html</a>
      </font>
    </ul>
</section>

<section id="ENDser">
  <h1>END</h1>
      <font size=7>
        <br><br><a href="mailto:jorge.boucas@age.mpg.de">jorge.boucas@age.mpg.de</a>
        <br><br><a href="mailto:bioinformatics@age.mpg.de">bioinformatics@age.mpg.de</a>
        <br><br><a href="http://bioinformatics.age.mpg.de">http://bioinformatics.age.mpg.de</a>
      </font>
</section>
